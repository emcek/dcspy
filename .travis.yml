dist: bionic
language: python
python:
  - '3.6'
  - '3.7'
  - '3.8'
matrix:
  include:
    - os: windows
      language: shell
      python: '3.8'
      before_install:
        - choco install python --version=3.8.6 --params '/InstallDir:C:\\Python'
#        - python -m pip install --upgrade pip
#        - export PATH='/c/Python:/c/Python/Scripts:$PATH'
      env: PATH=/c/Python:/c/Python/Scripts:$PATH
install:
  - pip3 install -U pip setuptools wheel
  - pip3 install -U six
  - pip3 install -U coveralls pycodestyle pydocstyle pytest-mccabe pytest-random pylint coverage codacy-coverage mypy
before_script:
  - pip3 install -Ur requirements.txt
  - python -V
script:
  - python -m pytest --mccabe -v dcspy
  - pycodestyle --statistics --count dcspy
  - pydocstyle --count dcspy
  - mypy --ignore-missing-imports dcspy || echo $(($? - 1))
  - pylint dcspy || echo $(($? % 4))
  - coverage run --source=dcspy -m pytest -v --random
  - coverage xml
after_success:
  - if [[ $TRAVIS_PYTHON_VERSION = 3.6 && $TRAVIS_OS_NAME = linux ]]; then coveralls; fi
  - if [[ $TRAVIS_PYTHON_VERSION = 3.8 && $TRAVIS_OS_NAME = linux ]]; then python-codacy-coverage -r coverage.xml; fi
deploy:
  provider: pypi
  distributions: sdist bdist_wheel
  user: __token__
  password:
    secure: LMQ9dVx3fKArgAK3KH4M1OyoiVW8gQKTBYOSD62sYyTKk78vFnFftlPjNifDKLFjaJXVD9ZEoOe9XYKDLHa95lFZrWAD61ObfHSVDg2Ww4NKLKdW/VRjC3xQCoh6dDkyeWlqpRUuE37yz/JQrechcJRgiMYnKoj0SkKzo9q52GI/pRQbECuP3wVsFnNSKc4+vBfFBtWSXe1hy9sgKRkeoWN9AR7bwT/fa3YM+HI//1/WW+j81kY+9TP7UqgdeHhAa36Ba0eVRDf78gNExqawYki9HtOZEHX8DvAOhhG8/XNceAUOMQqDSaZxqv0u2udPm766JGDf8EFU8QekkFHJObbdXr381riNwUlx1EYoyV8wGk5aglhQJy4CJlXXHSOxhcO256HK6kArrH/jhQ6yWfdGo5jljzIs3J9HT4QgdY//3aMRi34Iow3kg6K4+DwFjhkD3vCnt2FZPRQpZHBIbOLWKUwwIwnyhrmilfiaeu1b5f/YiwCovF86DME0k73yzqAYx1+20ohKBPdPZEYI3rTKM/wUGgq+bssibHMtvtyt1jA47E3h1HX047SdX+Cr/kY0yYvzJdLmjdIluFEFH1L0QexqJIGjk8s2f577bwQvcLjRLY99Y3hVmW8VUA+F1DLtuUIGBXiCvNRbZXPaUjdb4oFeY3zGZGgQsbtxo6I=
  on:
    tags: true
    condition: $TRAVIS_OS_NAME = linux
  skip_existing: true
cache: pip