dist: bionic
language: python
python:
  - '3.6'
  - '3.7'
  - '3.8'
matrix:
  include:
    - name: 'Windows Python 3.8'
      os: windows
      language: shell
      before_install:
        - choco install python --version=3.8.6
        - python -m pip install --upgrade pip
      env: PATH=/c/Python38:/c/Python38/Scripts:$PATH
install:
  - pip3 install -U pip setuptools wheel
  - pip3 install -U six
  - pip3 install -U coveralls pycodestyle pydocstyle pytest-mccabe pytest-random pylint coverage codacy-coverage mypy
before_script:
  - pip3 install -Ur requirements.txt
  - python -V
script:
  - python -m pytest --mccabe -v dcspy
  - pycodestyle --statistics --count dcspy
  - pydocstyle --count dcspy
  - mypy --ignore-missing-imports dcspy || echo $(($? - 1))
  - pylint dcspy || echo $(($? % 4))
  - coverage run --source=dcspy -m pytest -v --random
  - coverage xml
after_success:
  - if [[ $TRAVIS_PYTHON_VERSION = 3.6 && $TRAVIS_OS_NAME = linux ]]; then coveralls; fi
  - if [[ $TRAVIS_PYTHON_VERSION = 3.8 && $TRAVIS_OS_NAME = linux ]]; then python-codacy-coverage -r coverage.xml; fi
deploy:
  provider: pypi
  distributions: sdist bdist_wheel
  user: __token__
  password:
    secure: ${{ secrets.PYPI_TOKEN }}
  on:
    tags: true
    condition: $TRAVIS_OS_NAME = linux
  skip_existing: true
cache: pip
